//! Type trait for the mantissa of an extended float.

use util::*;
use super::rounding::RoundingParameters;

/// Type trait for the mantissa type.
pub trait Mantissa: UnsignedInteger {
    /// Mask for the left-most bit, to check if the value is normalized.
    const NORMALIZED_MASK: Self;
    /// Mask to extract the high bits from the integer.
    const HIMASK: Self;
    /// Mask to extract the low bits from the integer.
    const LOMASK: Self;
    /// Size of the integer, in bits.
    const BITS: i32;
    /// Half the size of the integer, in bits
    const HALF: i32 = Self::BITS / 2;
    /// Rounding parameters for the mantissa.
    const ROUNDING_PARAMETERS: &'static [RoundingParameters<Self>];
}

impl Mantissa for u64 {
    const NORMALIZED_MASK: u64  = 0x8000000000000000;
    const HIMASK: u64           = 0xFFFFFFFF00000000;
    const LOMASK: u64           = 0x00000000FFFFFFFF;
    const BITS: i32             = 64;
    const ROUNDING_PARAMETERS: &'static [RoundingParameters<u64>] = &[
        // mask: ((1<<shift) - 1), mid: ((mask / 2) + shift != 0)
        RoundingParameters { mask: 0, mid: 0, shift: 0 },
        RoundingParameters { mask: 0x1, mid: 0x1, shift: 1 },
        RoundingParameters { mask: 0x3, mid: 0x2, shift: 2 },
        RoundingParameters { mask: 0x7, mid: 0x4, shift: 3 },
        RoundingParameters { mask: 0xF, mid: 0x8, shift: 4 },
        RoundingParameters { mask: 0x1F, mid: 0x10, shift: 5 },
        RoundingParameters { mask: 0x3F, mid: 0x20, shift: 6 },
        RoundingParameters { mask: 0x7F, mid: 0x40, shift: 7 },
        RoundingParameters { mask: 0xFF, mid: 0x80, shift: 8 },
        RoundingParameters { mask: 0x1FF, mid: 0x100, shift: 9 },
        RoundingParameters { mask: 0x3FF, mid: 0x200, shift: 10 },
        RoundingParameters { mask: 0x7FF, mid: 0x400, shift: 11 },
        RoundingParameters { mask: 0xFFF, mid: 0x800, shift: 12 },
        RoundingParameters { mask: 0x1FFF, mid: 0x1000, shift: 13 },
        RoundingParameters { mask: 0x3FFF, mid: 0x2000, shift: 14 },
        RoundingParameters { mask: 0x7FFF, mid: 0x4000, shift: 15 },
        RoundingParameters { mask: 0xFFFF, mid: 0x8000, shift: 16 },
        RoundingParameters { mask: 0x1FFFF, mid: 0x10000, shift: 17 },
        RoundingParameters { mask: 0x3FFFF, mid: 0x20000, shift: 18 },
        RoundingParameters { mask: 0x7FFFF, mid: 0x40000, shift: 19 },
        RoundingParameters { mask: 0xFFFFF, mid: 0x80000, shift: 20 },
        RoundingParameters { mask: 0x1FFFFF, mid: 0x100000, shift: 21 },
        RoundingParameters { mask: 0x3FFFFF, mid: 0x200000, shift: 22 },
        RoundingParameters { mask: 0x7FFFFF, mid: 0x400000, shift: 23 },
        RoundingParameters { mask: 0xFFFFFF, mid: 0x800000, shift: 24 },
        RoundingParameters { mask: 0x1FFFFFF, mid: 0x1000000, shift: 25 },
        RoundingParameters { mask: 0x3FFFFFF, mid: 0x2000000, shift: 26 },
        RoundingParameters { mask: 0x7FFFFFF, mid: 0x4000000, shift: 27 },
        RoundingParameters { mask: 0xFFFFFFF, mid: 0x8000000, shift: 28 },
        RoundingParameters { mask: 0x1FFFFFFF, mid: 0x10000000, shift: 29 },
        RoundingParameters { mask: 0x3FFFFFFF, mid: 0x20000000, shift: 30 },
        RoundingParameters { mask: 0x7FFFFFFF, mid: 0x40000000, shift: 31 },
        RoundingParameters { mask: 0xFFFFFFFF, mid: 0x80000000, shift: 32 },
        RoundingParameters { mask: 0x1FFFFFFFF, mid: 0x100000000, shift: 33 },
        RoundingParameters { mask: 0x3FFFFFFFF, mid: 0x200000000, shift: 34 },
        RoundingParameters { mask: 0x7FFFFFFFF, mid: 0x400000000, shift: 35 },
        RoundingParameters { mask: 0xFFFFFFFFF, mid: 0x800000000, shift: 36 },
        RoundingParameters { mask: 0x1FFFFFFFFF, mid: 0x1000000000, shift: 37 },
        RoundingParameters { mask: 0x3FFFFFFFFF, mid: 0x2000000000, shift: 38 },
        RoundingParameters { mask: 0x7FFFFFFFFF, mid: 0x4000000000, shift: 39 },
        RoundingParameters { mask: 0xFFFFFFFFFF, mid: 0x8000000000, shift: 40 },
        RoundingParameters { mask: 0x1FFFFFFFFFF, mid: 0x10000000000, shift: 41 },
        RoundingParameters { mask: 0x3FFFFFFFFFF, mid: 0x20000000000, shift: 42 },
        RoundingParameters { mask: 0x7FFFFFFFFFF, mid: 0x40000000000, shift: 43 },
        RoundingParameters { mask: 0xFFFFFFFFFFF, mid: 0x80000000000, shift: 44 },
        RoundingParameters { mask: 0x1FFFFFFFFFFF, mid: 0x100000000000, shift: 45 },
        RoundingParameters { mask: 0x3FFFFFFFFFFF, mid: 0x200000000000, shift: 46 },
        RoundingParameters { mask: 0x7FFFFFFFFFFF, mid: 0x400000000000, shift: 47 },
        RoundingParameters { mask: 0xFFFFFFFFFFFF, mid: 0x800000000000, shift: 48 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFF, mid: 0x1000000000000, shift: 49 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFF, mid: 0x2000000000000, shift: 50 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFF, mid: 0x4000000000000, shift: 51 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFF, mid: 0x8000000000000, shift: 52 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFF, mid: 0x10000000000000, shift: 53 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFF, mid: 0x20000000000000, shift: 54 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFF, mid: 0x40000000000000, shift: 55 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFF, mid: 0x80000000000000, shift: 56 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFF, mid: 0x100000000000000, shift: 57 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFF, mid: 0x200000000000000, shift: 58 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFF, mid: 0x400000000000000, shift: 59 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFF, mid: 0x800000000000000, shift: 60 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFF, mid: 0x1000000000000000, shift: 61 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFF, mid: 0x2000000000000000, shift: 62 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFF, mid: 0x4000000000000000, shift: 63 },
    ];
}

impl Mantissa for u128 {
    const NORMALIZED_MASK: u128 = 0x80000000000000000000000000000000;
    const HIMASK: u128          = 0xFFFFFFFFFFFFFFFF0000000000000000;
    const LOMASK: u128          = 0x0000000000000000FFFFFFFFFFFFFFFF;
    const BITS: i32             = 128;
    const ROUNDING_PARAMETERS: &'static [RoundingParameters<u128>] = &[
        // mask: ((1<<shift) - 1), mid: ((mask / 2) + shift != 0)
        RoundingParameters { mask: 0, mid: 0, shift: 0 },
        RoundingParameters { mask: 0x1, mid: 0x1, shift: 1 },
        RoundingParameters { mask: 0x3, mid: 0x2, shift: 2 },
        RoundingParameters { mask: 0x7, mid: 0x4, shift: 3 },
        RoundingParameters { mask: 0xF, mid: 0x8, shift: 4 },
        RoundingParameters { mask: 0x1F, mid: 0x10, shift: 5 },
        RoundingParameters { mask: 0x3F, mid: 0x20, shift: 6 },
        RoundingParameters { mask: 0x7F, mid: 0x40, shift: 7 },
        RoundingParameters { mask: 0xFF, mid: 0x80, shift: 8 },
        RoundingParameters { mask: 0x1FF, mid: 0x100, shift: 9 },
        RoundingParameters { mask: 0x3FF, mid: 0x200, shift: 10 },
        RoundingParameters { mask: 0x7FF, mid: 0x400, shift: 11 },
        RoundingParameters { mask: 0xFFF, mid: 0x800, shift: 12 },
        RoundingParameters { mask: 0x1FFF, mid: 0x1000, shift: 13 },
        RoundingParameters { mask: 0x3FFF, mid: 0x2000, shift: 14 },
        RoundingParameters { mask: 0x7FFF, mid: 0x4000, shift: 15 },
        RoundingParameters { mask: 0xFFFF, mid: 0x8000, shift: 16 },
        RoundingParameters { mask: 0x1FFFF, mid: 0x10000, shift: 17 },
        RoundingParameters { mask: 0x3FFFF, mid: 0x20000, shift: 18 },
        RoundingParameters { mask: 0x7FFFF, mid: 0x40000, shift: 19 },
        RoundingParameters { mask: 0xFFFFF, mid: 0x80000, shift: 20 },
        RoundingParameters { mask: 0x1FFFFF, mid: 0x100000, shift: 21 },
        RoundingParameters { mask: 0x3FFFFF, mid: 0x200000, shift: 22 },
        RoundingParameters { mask: 0x7FFFFF, mid: 0x400000, shift: 23 },
        RoundingParameters { mask: 0xFFFFFF, mid: 0x800000, shift: 24 },
        RoundingParameters { mask: 0x1FFFFFF, mid: 0x1000000, shift: 25 },
        RoundingParameters { mask: 0x3FFFFFF, mid: 0x2000000, shift: 26 },
        RoundingParameters { mask: 0x7FFFFFF, mid: 0x4000000, shift: 27 },
        RoundingParameters { mask: 0xFFFFFFF, mid: 0x8000000, shift: 28 },
        RoundingParameters { mask: 0x1FFFFFFF, mid: 0x10000000, shift: 29 },
        RoundingParameters { mask: 0x3FFFFFFF, mid: 0x20000000, shift: 30 },
        RoundingParameters { mask: 0x7FFFFFFF, mid: 0x40000000, shift: 31 },
        RoundingParameters { mask: 0xFFFFFFFF, mid: 0x80000000, shift: 32 },
        RoundingParameters { mask: 0x1FFFFFFFF, mid: 0x100000000, shift: 33 },
        RoundingParameters { mask: 0x3FFFFFFFF, mid: 0x200000000, shift: 34 },
        RoundingParameters { mask: 0x7FFFFFFFF, mid: 0x400000000, shift: 35 },
        RoundingParameters { mask: 0xFFFFFFFFF, mid: 0x800000000, shift: 36 },
        RoundingParameters { mask: 0x1FFFFFFFFF, mid: 0x1000000000, shift: 37 },
        RoundingParameters { mask: 0x3FFFFFFFFF, mid: 0x2000000000, shift: 38 },
        RoundingParameters { mask: 0x7FFFFFFFFF, mid: 0x4000000000, shift: 39 },
        RoundingParameters { mask: 0xFFFFFFFFFF, mid: 0x8000000000, shift: 40 },
        RoundingParameters { mask: 0x1FFFFFFFFFF, mid: 0x10000000000, shift: 41 },
        RoundingParameters { mask: 0x3FFFFFFFFFF, mid: 0x20000000000, shift: 42 },
        RoundingParameters { mask: 0x7FFFFFFFFFF, mid: 0x40000000000, shift: 43 },
        RoundingParameters { mask: 0xFFFFFFFFFFF, mid: 0x80000000000, shift: 44 },
        RoundingParameters { mask: 0x1FFFFFFFFFFF, mid: 0x100000000000, shift: 45 },
        RoundingParameters { mask: 0x3FFFFFFFFFFF, mid: 0x200000000000, shift: 46 },
        RoundingParameters { mask: 0x7FFFFFFFFFFF, mid: 0x400000000000, shift: 47 },
        RoundingParameters { mask: 0xFFFFFFFFFFFF, mid: 0x800000000000, shift: 48 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFF, mid: 0x1000000000000, shift: 49 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFF, mid: 0x2000000000000, shift: 50 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFF, mid: 0x4000000000000, shift: 51 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFF, mid: 0x8000000000000, shift: 52 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFF, mid: 0x10000000000000, shift: 53 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFF, mid: 0x20000000000000, shift: 54 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFF, mid: 0x40000000000000, shift: 55 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFF, mid: 0x80000000000000, shift: 56 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFF, mid: 0x100000000000000, shift: 57 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFF, mid: 0x200000000000000, shift: 58 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFF, mid: 0x400000000000000, shift: 59 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFF, mid: 0x800000000000000, shift: 60 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFF, mid: 0x1000000000000000, shift: 61 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFF, mid: 0x2000000000000000, shift: 62 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFF, mid: 0x4000000000000000, shift: 63 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFFF, mid: 0x8000000000000000, shift: 64 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFFF, mid: 0x10000000000000000, shift: 65 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFFF, mid: 0x20000000000000000, shift: 66 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFFF, mid: 0x40000000000000000, shift: 67 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFFFF, mid: 0x80000000000000000, shift: 68 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFFFF, mid: 0x100000000000000000, shift: 69 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFFFF, mid: 0x200000000000000000, shift: 70 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFFFF, mid: 0x400000000000000000, shift: 71 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFFFFF, mid: 0x800000000000000000, shift: 72 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFFFFF, mid: 0x1000000000000000000, shift: 73 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFFFFF, mid: 0x2000000000000000000, shift: 74 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFFFFF, mid: 0x4000000000000000000, shift: 75 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFFFFFF, mid: 0x8000000000000000000, shift: 76 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFFFFFF, mid: 0x10000000000000000000, shift: 77 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFFFFFF, mid: 0x20000000000000000000, shift: 78 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFFFFFF, mid: 0x40000000000000000000, shift: 79 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFFFFFFF, mid: 0x80000000000000000000, shift: 80 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFFFFFFF, mid: 0x100000000000000000000, shift: 81 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFFFFFFF, mid: 0x200000000000000000000, shift: 82 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFFFFFFF, mid: 0x400000000000000000000, shift: 83 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFFFFFFFF, mid: 0x800000000000000000000, shift: 84 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFFFFFFFF, mid: 0x1000000000000000000000, shift: 85 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFFFFFFFF, mid: 0x2000000000000000000000, shift: 86 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFFFFFFFF, mid: 0x4000000000000000000000, shift: 87 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFFFFFFFFF, mid: 0x8000000000000000000000, shift: 88 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFFFFFFFFF, mid: 0x10000000000000000000000, shift: 89 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFFFFFFFFF, mid: 0x20000000000000000000000, shift: 90 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFFFFFFFFF, mid: 0x40000000000000000000000, shift: 91 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x80000000000000000000000, shift: 92 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFFFFFFFFFF, mid: 0x100000000000000000000000, shift: 93 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFFFFFFFFFF, mid: 0x200000000000000000000000, shift: 94 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFFFFFFFFFF, mid: 0x400000000000000000000000, shift: 95 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x800000000000000000000000, shift: 96 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x1000000000000000000000000, shift: 97 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x2000000000000000000000000, shift: 98 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x4000000000000000000000000, shift: 99 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x8000000000000000000000000, shift: 100 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x10000000000000000000000000, shift: 101 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x20000000000000000000000000, shift: 102 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x40000000000000000000000000, shift: 103 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x80000000000000000000000000, shift: 104 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x100000000000000000000000000, shift: 105 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x200000000000000000000000000, shift: 106 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x400000000000000000000000000, shift: 107 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x800000000000000000000000000, shift: 108 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x1000000000000000000000000000, shift: 109 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x2000000000000000000000000000, shift: 110 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x4000000000000000000000000000, shift: 111 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x8000000000000000000000000000, shift: 112 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x10000000000000000000000000000, shift: 113 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x20000000000000000000000000000, shift: 114 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x40000000000000000000000000000, shift: 115 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x80000000000000000000000000000, shift: 116 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x100000000000000000000000000000, shift: 117 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x200000000000000000000000000000, shift: 118 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x400000000000000000000000000000, shift: 119 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x800000000000000000000000000000, shift: 120 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x1000000000000000000000000000000, shift: 121 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x2000000000000000000000000000000, shift: 122 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x4000000000000000000000000000000, shift: 123 },
        RoundingParameters { mask: 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x8000000000000000000000000000000, shift: 124 },
        RoundingParameters { mask: 0x1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x10000000000000000000000000000000, shift: 125 },
        RoundingParameters { mask: 0x3FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x20000000000000000000000000000000, shift: 126 },
        RoundingParameters { mask: 0x7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF, mid: 0x40000000000000000000000000000000, shift: 127 },
    ];
}
