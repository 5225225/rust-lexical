sudo: false

language: rust

matrix:
  include:
    - rust: stable
    - rust: beta

    - rust: nightly
      script:
        - cargo build
        - cargo test
        - cd lexical-core
        - cargo test
        - cargo test --no-default-features --tests
        - cargo test --no-default-features --features=rounding  --tests
        - cargo test --no-default-features --features=rounding,radix  --tests
        - cargo test --no-default-features --features=rounding,unchecked_index  --tests
        - cargo test --no-default-features --features=trim_floats --tests
        - cargo test --no-default-features --features=trim_floats,radix --tests
        - cargo test --no-default-features --features=trim_floats,unchecked_index --tests
        - cargo test --no-default-features --features=table --tests
        - cargo test --no-default-features --features=table,radix --tests
        - cargo test --no-default-features --features=table,unchecked_index --tests
        - cargo test --no-default-features --features=grisu3 --tests
        - cargo test --no-default-features --features=ryu --tests
        - cargo test --no-default-features --features=correct --tests
        - cargo test --no-default-features --features=correct,radix --tests
        - cargo test --no-default-features --features=correct,unchecked_index --tests
        - cargo test --no-default-features --features=correct,radix --tests special_rounding -- --ignored --test-threads=1
        - cargo test --features=correct,rounding,radix special_rounding -- --ignored --test-threads=1
        - cd ..
        - cargo bench --verbose --no-run

    # Tests fail below 1.27.0
    - rust: 1.24.0
      script:
        - cargo build
        - cd lexical-core
        - cargo build

    # Doc tests fail below 1.30.0.
    - rust: 1.27.0
      script:
        - cargo build
        - cargo test --tests
        - cd lexical-core
        - cargo test

    # All tests should work.
    - rust: 1.30.0

script:
  - cargo build
  - cargo test
  - cd lexical-core
  - cargo test --features=std
  - cargo test --no-default-features --features=std
  - cargo test --no-default-features --features=std,rounding
  - cargo test --no-default-features --features=std,rounding,radix
  - cargo test --no-default-features --features=std,rounding,unchecked_index
  - cargo test --no-default-features --features=std,trim_floats
  - cargo test --no-default-features --features=std,trim_floats,radix
  - cargo test --no-default-features --features=std,trim_floats,unchecked_index
  - cargo test --no-default-features --features=std,table
  - cargo test --no-default-features --features=std,table,radix
  - cargo test --no-default-features --features=std,table,unchecked_index
  - cargo test --no-default-features --features=std,grisu3
  - cargo test --no-default-features --features=std,ryu
  - cargo test --no-default-features --features=std,correct
  - cargo test --no-default-features --features=std,correct,radix
  - cargo test --no-default-features --features=std,correct,unchecked_index
  - cargo test --features=correct,radix special_rounding -- --ignored --test-threads=1
  - cargo test --features=correct,rounding,radix special_rounding -- --ignored --test-threads=1
  - cd ..
  - cargo bench --verbose --no-run
